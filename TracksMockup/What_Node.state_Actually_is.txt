Узел может быть тупиком, промежуточным, стрелочным переводом и перекрёстком.
Старшие два бита - тип узла (от 00=тупик до 11=перекрёсток).

У каждого узла по 4 указателя на пути. При этом три их них могут быть нулевыми.

Тупик дополнительно знает только лицом или опой к нему повёрнут путь
Т.е. какой из указателей fwd или bck указывает на него. Это третий слева бит.
fwd = 0, bck = 1

Промежуточник дополнительно знает направление уже двух участков путей.
Биты 3 и 4, аналогично тупику. Бит 3 отвечает за "младший" путь,
т.е. по непустому указателю с ненулевым индексом. 4 - за "старший".

У перевода есть указатель на корень, два на ветки и пустой.
Перевод знает, как повёрнуты к нему три участка. Биты 3, 4 и 5.
Аналогично предыдущим пунктам. Следующие два бита (6 и 7) отвечают
за то, какой из трёх путей - "корень" (точнее, по какому он индексу,
т.е. 00 значит, что корень по индеску ноль, 01 - по 1 и т.д.).
Последний бит хранит состояние перевода. 0 - в режиме корень-младший узел
1 - корень-старший узел.

Перекрёсток в битах 3 - 6 хранит ориентацию четырёх своих путей,
аналогично предыдущим пунктам. Биты 7 и 8 задают индекс пути, с которым связан
путь по индексу ноль.

Стрелка на перекрёстке недопустима. Перекрёсток, имеющий нулевые указатели
должен действовать в поисках маршрута как тупик, если зайти на него с "неправильной" стороны.

Недопустимые состояния (не-тупик с одним ненулём, например) закинут в ебло исключение.